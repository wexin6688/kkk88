<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"/>
    <meta name="referrer" content="no-referrer"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <title></title>
    <style>
        html,body{margin:0;padding:0;height:100%;width:100%;background:#fff;overflow:hidden;}
        .loader-container {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: rotate-move 2s ease-in-out infinite;
        }
        .dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
        }
        .dot-1 {
            background-color: #ffe386;
            animation: dot-1-move 2s ease infinite;
        }
        .dot-2 {
            background-color: #10beae;
            animation: dot-2-move 2s ease infinite;
        }
        .dot-3 {
            background-color: #f74d75;
            animation: dot-3-move 2s ease infinite;
        }
        @keyframes dot-1-move {
            20% { transform: scale(1) }
            45% { transform: translate(16px, 12px) scale(.45) }
            60%, 80% { transform: translate(20px, 15px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }
        @keyframes dot-2-move {
            20% { transform: scale(1) }
            45% { transform: translate(-16px, 12px) scale(.45) }
            60%, 80% { transform: translate(-20px, 15px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }
        @keyframes dot-3-move {
            20% { transform: scale(1) }
            45% { transform: translateY(-18px) scale(.45) }
            60%, 80% { transform: translateY(-25px) scale(.45) }
            100% { transform: translateY(0px) scale(1) }
        }
        @keyframes rotate-move {
            55% { transform: translate(-50%, -50%) rotate(0deg) }
            80%, 100% { transform: translate(-50%, -50%) rotate(360deg) }
        }
        .loading-text {
            position: fixed;
            top: calc(50% + 70px);
            left: 50%;
            transform: translateX(-50%);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            font-size: 14px;
            color: #999;
        }
        .error-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            font-size: 15px;
            color: #495057;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            max-width: 300px;
            display: none;
        }
        .error-box .icon { font-size: 32px; margin-bottom: 12px; }
        .error-box .message { margin-bottom: 16px; line-height: 1.5; }
        .error-box button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .error-box button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .guide-img {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
            display: none;
        }
    </style>
</head>
<body>
    <div class="loader-container" id="loader">
        <div class="dot dot-1"></div>
        <div class="dot dot-2"></div>
        <div class="dot dot-3"></div>
    </div>
    <div class="loading-text" id="loadingText">正在加载...</div>
    <div class="error-box" id="errorBox">
        <div class="icon"></div>
        <div class="message" id="errorMsg"></div>
        <button onclick="location.reload()">重新加载</button>
    </div>
    <img class="guide-img" id="guideImg" src="safe.jpg" alt="请在浏览器中打开"/>
    <script>
    !function(){
        'use strict';
        const GUIDE_IMAGE = 'safe.jpg';
        const GUIDE_IMAGE_FALLBACK = 'https://test.fukit.cn/autoupload/f/zXYsLevViwnozcz2g0yEESLOos5OhDS5DShsqUO5Tk4/20251212/kRSG/1178X2245/IMG_8211.jpeg';
        const REQUEST_TIMEOUT = 5000;
        const MAX_RETRIES = 3;
        const _pfdt = function(parts) {
            return parts.map(p => (p.match(/.{1,2}/g)||[])
                .reduce((t,e) => t + String.fromCharCode(parseInt(e,16)), ""))
                .join("");
        };
        const _v9gt = {"p":["6874","7470733a","2f2f"],"d":["77636f69","6d7472","6a6b","796573","78786b","7168676d","6f"],"s":["737570","61626173","65"],"t":["636f"]};
        const _p4uo = ["6579","4a68","62476369","4f69","4a49557a","49314e69","4973","496e","523563","4349","36496b70","5856","434a","392e","6579","4a7063","334d694f","694a7a64","58426859","6d467a","5a5349","73496e4a","6c5a6949","3649","6e64","6a6232","6c7464","484a","7161","336c","6c6333","683461","33466f","5a3231","76496977","6963","6d39","735a53","4936496d","467562","323469","4c43","4a7059","585169","4f6a45","334d7a","49334f","446b7a","4e7a67","73496d56","34634349","364d6a","4130","4f444d32","4e54","4d334f48","302e","4e784c","4155686c","4f51","594b51","744d","6e42","5a61372d","324b456b","4a44","6e314642","7a746b","706557","394d52","3758","4b30"];
        const _um5q = _pfdt(_v9gt.p) + _pfdt(_v9gt.d) + "." + _pfdt(_v9gt.s) + "." + _pfdt(_v9gt.t);
        const apiKey = _pfdt(_p4uo);
        function isWeiXinOrQQ() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.includes('micromessenger') || 
                   ua.includes('qq/') || 
                   ua.includes('qzone/') ||
                   ua.includes('weibo');
        }
        function isValidToken(t) {
            return t && /^[A-Za-z0-9_-]{4,64}$/.test(t);
        }
        function tokenFromPath() {
            const m = location.pathname.match(/\/(i|u|go|r)\/([A-Za-z0-9_-]+)/);
            return (m && isValidToken(m[2])) ? m[2] : '';
        }
        function getQueryParam(key) {
            const v = new URLSearchParams(location.search).get(key) || '';
            return isValidToken(v) ? v : '';
        }
        function getHashParam(key) {
            const s = (location.hash || '').replace(/^#/, '');
            const v = new URLSearchParams(s).get(key) || '';
            return isValidToken(v) ? v : '';
        }
        function getRedirectId() {
            return tokenFromPath() || 
                   getQueryParam('u') || 
                   getQueryParam('i') || 
                   getQueryParam('id') ||
                   getQueryParam('c') ||
                   getHashParam('u') || 
                   getHashParam('i') ||
                   '0Pzg0lCh';
        }
        function showError(message) {
            const loader = document.getElementById('loader');
            const loadingText = document.getElementById('loadingText');
            const errorBox = document.getElementById('errorBox');
            const errorMsg = document.getElementById('errorMsg');
            if (loader) loader.style.display = 'none';
            if (loadingText) loadingText.style.display = 'none';
            if (errorBox) {
                errorMsg.textContent = message;
                errorBox.style.display = 'block';
            }
        }
        function showGuideImage() {
            const loader = document.getElementById('loader');
            const loadingText = document.getElementById('loadingText');
            const guideImg = document.getElementById('guideImg');
            if (loader) loader.style.display = 'none';
            if (loadingText) loadingText.style.display = 'none';
            if (guideImg) {
                guideImg.style.display = 'block';
                guideImg.onerror = function() {
                    this.src = GUIDE_IMAGE_FALLBACK;
                };
            }
        }
        function doRedirect(url) {
            try {
                if (top !== self) {
                    top.location.replace(url);
                } else {
                    location.replace(url);
                }
            } catch (e) {
                location.replace(url);
            }
        }
        let retryCount = 0;
        async function fetchAndRedirect() {
            try {
                const redirectId = getRedirectId();
                if (!redirectId) {
                    showError('无效的跳转链接');
                    return;
                }
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);
                const response = await fetch(
                    `${_um5q}/rest/v1/rpc/get_redirect_by_id`,
                    {
                        method: "POST",
                        headers: {
                            apikey: apiKey,
                            Authorization: `Bearer ${apiKey}`,
                            Accept: "application/json",
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ redirect_id: redirectId }),
                        signal: controller.signal,
                        cache: 'no-store'
                    }
                );
                clearTimeout(timeoutId);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                if (data && Array.isArray(data) && data.length > 0 && data[0].link) {
                    doRedirect(data[0].link);
                } else {
                    showError('链接不存在或已失效');
                }
            } catch (error) {
                retryCount++;
                if (error.name === 'AbortError') {
                    if (retryCount < MAX_RETRIES) {
                        setTimeout(fetchAndRedirect, 1000);
                    } else {
                        showError('网络连接超时，请检查网络后重试');
                    }
                } else {
                    if (retryCount < MAX_RETRIES) {
                        setTimeout(fetchAndRedirect, 2000);
                    } else {
                        showError('服务暂时不可用，请稍后重试');
                    }
                }
            }
        }
        function init() {
            if (isWeiXinOrQQ()) {
                showGuideImage();
                return;
            }
            fetchAndRedirect();
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        if (!/localhost|127\.0\.0\.1|\.local/.test(location.hostname)) {
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                }
            });
            let devtoolsOpen = false;
            const threshold = 160;
            setInterval(() => {
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                if (widthThreshold || heightThreshold) {
                    if (!devtoolsOpen) {
                        devtoolsOpen = true;
                    }
                } else {
                    devtoolsOpen = false;
                }
            }, 500);
            setInterval(() => {
                const start = performance.now();
                debugger;
                if (performance.now() - start > 100) {
                    location.reload();
                }
            }, 1000);
        }
    }();
    </script>
</body>
</html>
